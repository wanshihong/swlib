## 2. 快速开始

### 2.1 环境要求

- **PHP**: >= 8.4
- **Swoole**: >= 6.0.0
- **扩展**: mysqli, redis, bcmath, curl, openssl, mbstring, gd, gmagick
- **数据库**: MySQL 5.7+ / MariaDB 10.3+
- **缓存**: Redis 5.0+

### 2.2 安装

#### 使用 Composer 安装

```bash
composer require wansh/swlib
```

#### 配置自动加载

```json
{
  "autoload": {
    "psr-4": {
      "App\\": [
        "runtime/Proxy/App/",
        "App/"
      ],
      "Generate\\": "runtime/Generate",
      "GPBMetadata\\": "runtime/Protobuf/GPBMetadata/",
      "Protobuf\\": "runtime/Protobuf/Protobuf/",
      "Swlib\\": [
        "runtime/Proxy/Swlib/",
        "Swlib/"
      ]
    }
  }
}
```

### 2.3 环境配置

创建 `.env` 文件：

```env
# 应用配置
APP_PROD=false
APP_NAME=all
WORKER_NUM=2
TASK_WORKER_NUM=2
PORT=9501

# 数据库配置
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=your_database
DB_ROOT=root
DB_PWD=your_password
DB_CHARSET=utf8mb4
DB_SLOW_TIME=300
DB_SAVE_SQL=true
DB_POOL_NUM=10
DB_HEART=10

# Redis 配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_AUTH=
REDIS_POOL_NUM=10

# 后台管理配置
ADMIN_CONFIG_PATH=App\AdminConfig
```

### 2.4 创建启动文件

```php
<?php
// bin/start.php
declare(strict_types=1);
require_once "./vendor/autoload.php";

use Generate\ConfigEnum;
use Swlib\App;

define('ROOT_DIR', dirname(__DIR__) . DIRECTORY_SEPARATOR);
const APP_DIR = ROOT_DIR . 'App' . DIRECTORY_SEPARATOR;
const PUBLIC_DIR = ROOT_DIR . 'public' . DIRECTORY_SEPARATOR;
const RUNTIME_DIR = ROOT_DIR . 'runtime' . DIRECTORY_SEPARATOR;

$app = new App();

try {
    $config = [
        'hook_flags' => SWOOLE_HOOK_ALL,
        'daemonize' => ConfigEnum::APP_PROD,
        'worker_num' => ConfigEnum::WORKER_NUM,
        'task_worker_num' => ConfigEnum::TASK_WORKER_NUM,
        'task_enable_coroutine' => true,
        'enable_coroutine' => true,
        'reload_async' => true,
        'log_file' => RUNTIME_DIR . '/log/server_error.log'
    ];

    if (!ConfigEnum::APP_PROD) {
        $config['document_root'] = PUBLIC_DIR;
        $config['enable_static_handler'] = true;
    }

    $app->startSwooleServer($config);
} catch (Throwable $e) {
    echo "启动失败: " . $e->getMessage() . PHP_EOL;
    echo $e->getTraceAsString() . PHP_EOL;
}
```

### 2.5 启动应用

```bash
# 启动服务器
php bin/start.php

# 后台运行
nohup php bin/start.php > /dev/null 2>&1 &
```

访问 `http://127.0.0.1:9501` 即可看到欢迎页面。

### 2.6 目录结构

```
project/
├── App/                    # 应用代码
│   ├── Controller/         # 控制器
│   ├── Service/           # 服务层
│   ├── Model/             # 模型层
│   └── AdminConfig.php    # 后台配置
├── Swlib/                 # 框架核心
├── bin/                   # 启动脚本
│   └── start.php
├── public/                # 静态资源
├── runtime/               # 运行时文件
│   ├── Generate/          # 自动生成的代码
│   ├── Protobuf/          # Protobuf 文件
│   ├── Proxy/             # AOP 代理类
│   └── log/               # 日志文件
├── .env                   # 环境配置
└── composer.json
```


