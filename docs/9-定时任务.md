## 9. 定时任务

框架提供了基于 Cron 表达式的定时任务调度系统。

### 9.1 定义定时任务

```php
use Swlib\Crontab\Attribute\CrontabAttribute;

#[CrontabAttribute(
    cron: '0 */2 * * *',      // Cron 表达式：每2小时执行一次
    enable_coroutine: true,   // 是否启用协程
    timeout: 300              // 超时时间（秒）
)]
class DataCleanupTask
{
    public function run($server): void
    {
        // 清理过期数据
        $this->cleanExpiredData();
    }

    private function cleanExpiredData(): void
    {
        // 清理逻辑
    }
}
```

### 9.2 Cron 表达式

```
* * * * *
│ │ │ │ │
│ │ │ │ └─── 星期 (0-6, 0=周日)
│ │ │ └───── 月份 (1-12)
│ │ └─────── 日期 (1-31)
│ └───────── 小时 (0-23)
└─────────── 分钟 (0-59)
```

| 表达式 | 说明 | 示例 |
|--------|------|------|
| `0 * * * *` | 每小时整点 | 每天00分执行 |
| `*/5 * * * *` | 每5分钟 | 0,5,10...执行 |
| `0 */2 * * *` | 每2小时 | 0点,2点,4点...执行 |
| `0 0 * * *` | 每天午夜 | 每天00:00执行 |
| `0 0 * * 0` | 每周日午夜 | 每周日00:00执行 |
| `0 0 1 * *` | 每月1号午夜 | 每月1日00:00执行 |

### 9.3 任务特性

- **防重复执行**：同一分钟内只执行一次
- **协程支持**：任务可在协程中执行
- **超时控制**：可设置任务超时时间
- **异常处理**：自动记录异常日志
